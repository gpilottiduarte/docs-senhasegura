<!-- ## Metadata_Start 
## code: pt
## title: Operação encadeada 
## slug: chained-operation-automation 
## seoTitle: Operação encadeada 
## description:  
## contentType: Wysiwyg 
## Metadata_End -->
<p>Automatizar as operações de alteração de senha permite que usuários com privilégios de administrador realizem operações, como alteração de senha vinculada, automática ou manualmente.</p><section class="infoBox"><div class="title">Info</div><div class="content"><p>A execução vinculada é entendida como uma operação onde <strong>a senha de uma credencial de destino deve ser replicada para vários destinos diferentes</strong>. Às vezes, contendo sistemas diferentes que exigem executores e modelos diferentes. Por exemplo: Garantir que a senha do banco de dados seja replicada para serviços hospedados em servidores Linux e Windows.</p><p>Usando a sintaxe de elaboração do script de automação, você pode determinar se a operação será executada quando todas as credenciais forem alteradas com sucesso ou mesmo quando apenas parte delas tiver sido executada com sucesso.</p></div></section><p>Na configuração de um script de execução, é possível selecionar a operação a ser realizada, bem como a força das senhas alteradas.</p><p>A execução também pode ser configurada automaticamente em dias e períodos predeterminados. Você também pode selecionar um intervalo mínimo entre as execuções de alteração de senha vinculadas.</p><section class="warningBox"><div class="title">Atenção</div><div class="content"><p>Para exemplificar seu uso neste documento utilizaremos a automação para executar scripts de alteração de senha, porém esta funcionalidade pode ser utilizada para qualquer script.</p></div></section><hr><h2>SQL Linked Server</h2><p>Usando o <strong>senhasegura Operation Automation</strong>, você pode alterar facilmente as senhas dos Microsoft®SQL Server Linked Servers replicando contas usando modelos prontos para uso do senhasegura para instâncias do SQL Server.</p><p>O senhasegura oferece dois modelos diferentes para lidar com <strong>configuração de porta dinâmica</strong> ou <strong>configuração de porta estática</strong>.</p><section class="warningBox"><div class="title">Atenção</div><div class="content"><p>Quando o SQL Server trabalha com configuração de porta dinâmica, você deve configurar o dispositivo senhasegura com a porta UDP onde o SQL Server publicará em qual porta TCP o SQL Server está sendo executado.</p></div></section><figure data-tomark-pass=""><div class="fr-img-space-wrap"><span class="fr-img-caption fr-fic fr-fil fr-dib" style="width: 985px;"><span class="fr-img-wrap"><img src="https://cdn.document360.io/5a1d58df-64ce-42a2-8b23-688477d32f33/Images/Documentation/image-1665071199812.png" class="fr-fic fr-fil fr-dib"><span class="fr-inner"><figcaption data-tomark-pass="">O fluxo de operação automatizado para SQL Linked Server</figcaption></span></span></span><p class="fr-img-space-wrap2">&nbsp;</p></div></figure><p>Na imagem de exemplo, essa arquitetura é composta por duas instâncias do Microsoft®SQL Server em execução com portas dinâmicas do Linked Server. Portanto, o dispositivo cadastrado no senhasegura deve ter a porta UDP configurada.</p><p>O senhasegura então primeiro consultará a porta UDP para a porta TCP correta onde o SQL Server está aceitando conexões de banco de dados. Assim, o senhasegura se conectará a esta porta para realizar as tarefas do modelo.</p><p>Concluída esta primeira instância, e não importa se foi executada com sucesso ou não, o senhasegura se conectará ao próximo servidor e seguirá.</p><p>A principal diferença entre o uso de operação encadeada e credencial pai é que na operação encadeada você pode usar uma sintaxe especial para determinar qual modelo deve ser substituído para ambientes de Servidor Vinculado.</p><hr><h2>Registrar uma automação</h2><p>Para cadastrar uma automação, acesse o menu <strong>Execuções ➔ Automação de operações ➔ Automações</strong></p><ol><li>Clique no botão de ações e selecione a opção <strong>Novo</strong></li><li>Na guia de <strong>Configurações</strong>, preencha os seguintes campos:<ul><li><strong>Nome da automação:</strong> Nome. Apenas para controle interno</li><li><strong>Operação:</strong> tipo de automação. Nesta versão, apenas a opção <strong>Chained exchange</strong> estará disponível</li><li><strong>Força da senha:</strong> Força da senha usada para automação. <strong>Recomendamos usar a política de senha de dispositivo mais fraca para garantir que todos os membros da cadeia recebam a mesma senha.</strong></li><li><strong>Script de execução:</strong> script que compõe a cadeia de execução entre dispositivos</li><li><strong>Ativo:</strong> indica se a automação está ativa para uso ou não</li></ul></li><li>Na guia <strong>Execução</strong>, preencha os seguintes campos:<ul><li><strong>Habilitar execução automática:</strong> indica se a execução automática de automação está ativa ou não. Se ativado, o senhasegura realizará sua execução de tempos em tempos</li><li><strong>Dias para execução:</strong> a automação será executada em dias selecionados da semana</li><li><strong>Períodos de execução:</strong> A automação será realizada nos períodos selecionados</li><li><strong>Intervalo mínimo entre execuções:</strong> Intervalo mínimo entre execuções em horas</li></ul></li><li>Clique no botão <strong>Salvar</strong> para concluir as configurações.</li></ol><hr><h2>A sintaxe de um script de automação</h2><p>O script dará a sequência pela qual cada dispositivo será alcançado. Portanto, é importante que você já tenha essas informações mapeadas corretamente antes de começar a escrever o script.</p><h3><code data-backticks="1">check_conn</code></h3><p>Requer a validação da conectividade dos dispositivos de destino antes de iniciar o processo. Se o dispositivo de destino não estiver acessível, aborte a operação. Ele não contém argumentos adicionais e é preferível que este comando esteja no início do script.</p><h3><code data-backticks="1">rollnack</code></h3><p>Reverta a automação se nenhuma alteração for feita. A própria reversão será realizada apenas no final de toda a execução. Ou seja, em uma mudança de 10 credenciais, se ocorrer um erro na quarta credencial, ela ainda continuará executando as demais até o final e assim reverterá toda a operação.</p><p>Isso garante visibilidade ao administrador de quais credenciais estão com problemas.</p><p>Caso o comando de reversão não seja adicionado, o senhasegura realizará a alteração para todas as credenciais desejadas, mas não realizará a reversão se ocorrer um erro em uma, algumas ou todas as credenciais.</p><h3><code data-backticks="1">linked_tpl uint: id</code></h3><p>Determina qual template será usado para alterar as senhas ao lidar com um Linked Server.</p><p>Isso faz com que o modelo de alteração configurado na credencial seja ignorado e substituído pelo modelo designado no script.</p><p>O parâmetro <code data-backticks="1">id</code> é um número inteiro positivo referente ao Id do template desejado.</p><h3><code data-backticks="1">change string: type uint: id string: is_linked</code></h3><p>Altera a <strong>Credencial</strong> ou o <strong>Conjunto de credenciais</strong>, determinado pelos parâmetros <code data-backticks="1">type</code> e <code data-backticks="1">id</code>.</p><p>Se o parâmetro <code data-backticks="1">is_linked</code> for preenchido com <code data-backticks="1">linked</code>, o template determinado pelo comando <code data-backticks="1">linked_tpl</code> será usado para a mudança.</p><p>O parâmetro <code data-backticks="1">type</code> pode variar entre <code data-backticks="1">cred</code> para quando o valor de <code data-backticks="1">id</code> for o ID de uma credencial, ou <code data-backticks="1">pool</code> quando o valor de <code data-backticks="1">id</code> for o ID de um conjunto de credenciais.</p><p>O parâmetro <code data-backticks="1">id</code> sempre será um número inteiro positivo.</p><p>Veja o exemplo abaixo para melhor compreensão.</p><pre><code class="lang-json" data-code-id="section-1665071182361" data-language="json">## Lines started with sharp are comment

## Force connectivity validation before usage
check_conn

## Sets the linked server template.
## Its will use the template id 87
linked_tpl 87

## Sets the rollback flag
rollback

#### Sets the credential's or pool's change chain

## Change credentials 120 to 122.
## But credential 122 must use linked server template
change cred 120
change cred 121
change cred 122 linked

## Change credential pool 42 and 45
change pool 42
change pool 45
</code></pre><hr><h2>Execute uma automação</h2><p>Para executar uma automação, acesse o menu <strong>Executions ➔ Operations Automation ➔ Automation</strong>.</p><p>Clique no botão <strong>Executar</strong>. A automação das operações será agendada e o usuário poderá acompanhar o resultado no menu <strong>Ver execuções</strong>, descrito abaixo.</p><section class="infoBox"><div class="title">Info</div><div class="content">Em ações inativadas, a opção de execução é desativada</div></section><hr><h2>Ver execuções</h2><p>Para visualizar o histórico de execução da automação, acesse o menu <strong>Executions ➔ Operations Automation ➔ Executions</strong>.</p><p>Nesta tela, é possível visualizar diversas informações sobre as execuções de automação, como número de operações realizadas, resultado da execução, se processada, finalizada com erro, bem como o usuário solicitante e a data de execução da solicitação.</p><p>Clique no botão <strong>Visualizar operações</strong> para obter mais detalhes sobre o resultado de sua operação. Cada registro nesta tela corresponde à execução de cada credencial de destino.</p><p>Quando o script é configurado para executar um <strong>Pool de Credenciais</strong>, cada credencial no pool será mostrada registro por registro.</p>